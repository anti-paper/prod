[Top](../../../../index.md)\>
[プログラミング言語](../../../pgl.md)\>
[アセンブリ（MASM32）](../../language_0001.md)\>
[アセンブリ言語の実践的活用](../MASM32_0014.md)

# アセンブリ言語DLLの作成・利用

## 作成

### 書式（アセンブリ）
    .486
    .model flat,stdcall

    .code

    dllmain proc p1,p2,p3
        mov eax,1
        ret
    dllmain endp
    
    関数名 proc パラメータサイズ1:パラメータ1,パラメータサイズ2:パラメータ2,パラメータサイズ3:パラメータ3,・・・
        push esi
        処理
        pop esi
        ret
    関数名 endp

    end dllmain

dllmainは、DLLモジュールであることを示すための定型パターン

### 書式（アセンブル用バッチファイル）

    \masm32\bin\ml /c /coff ソースファイル名
    \masm32\bin\link オブジェクトファイル名 /dll

## 利用

### C/C\+\+プログラムでの利用

追加の依存ファイルに「関数名.lib」の形式のファイルを設定してリンク  
DLLが格納されたフォルダにパスを通す（環境変数設定）か、或いは実行するプログラムと同階層のフォルダにDLLをコピーして実行

#### DLL内の関数のプロトタイプ宣言（ヘッダファイル作成）

    extern "C" 戻り値のデータ型 __stdcall 関数名(引数のデータ型1 引数1,引数のデータ型2 引数2,引数のデータ型3 引数3,・・・);

#### ヘッダファイルのインクルード

    #include "ヘッダファイルのパス"

### Visual Basicプログラムでの利用

DLLが格納されたフォルダにパスを通す（環境変数設定）か、或いは実行するプログラムと同階層のフォルダにDLLをコピーして実行

#### DLL及びその中の関数の宣言

    Declare Auto Funnction 関数名 Lib "DLLファイル名"(Byval 引数名1 As 引数のデータ型1,Byval 引数名2 As 引数のデータ型2,Byval 引数名3 As 引数のデータ型3,・・・) As 戻り値のデータ型

### C\#プログラムでの利用

DLLが格納されたフォルダにパスを通す（環境変数設定）か、或いは実行するプログラムと同階層のフォルダにDLLをコピーして実行

#### DLL内関数呼び出しのためのオブジェクトが含まれる名前空間利用のための処理

    using System.Runtime.InteropServices;

プログラム本体の前に記述

#### DLL内の関数のプロトタイプ宣言

    [DLLImport("DLLファイル名)]
    public static extern 戻り値のデータ型 関数名(引数のデータ型1 引数1,引数のデータ型2 引数2,引数のデータ型3 引数3,・・・);