[Top](../../../../index.md)\>
[プログラミング言語](../../../pgl.md)\>
[アセンブリ（MASM32）](../../language_0001.md)\>
[基本的な命令](../MASM32_0009.md)

# 値の移動

+ [移動（コピー）命令](#移動コピー命令)
+ [ストリング命令](#ストリング命令)
+ [交換命令](#交換命令)
+ [プッシュとポップ](#プッシュとポップ)
<!-- + [ロードとストア](#ロードとストア) -->

## 移動（コピー）命令

ソースオペランドの値をディスティネーションオペランドに移動  
元のソースオペランドの値は変化しない  

### 書式

```mov ディスティネーションオペランド,ソースオペランド```

### オペランドに指定できる値

|オペランド|指定できる値|
----|----
|ディスティネーションオペランド|レジスタ、メモリ、セグメントレジスタ|
|ソースオペランド|レジスタ、メモリ、セグメントレジスタ、即値|

ディスティネーションオペランドとソースオペランドのサイズが異なる場合、エラーが発生する  
アドレスをレジスタに移動する際には、キーワード「OFFSET」を使用する

### 書式（アドレスを移動1）

```mov ディスティネーションオペランド,OFFSET ソースオペランド```

### 書式（アドレスを移動2）

```lea ディスティネーションオペランド,ソースオペランド```

## ストリング命令

メモリ上の連続したバイト、ワード又はダブルワード（ストリング）を一括で移動  
オペランドは、バイトでもワードでもダブルワードでも構わないが、ディスティネーションオペランドとソースオペランドのサイズは統一されている必要あり  
ESIレジスタに入っているアドレスのデータを、EDIレジスタに入っているアドレスのメモリに、ECXで指定した回数だけ移動

### 命令のイメージ

ESI（移動元データ） × ECX（回数） → EDI（移動先）

### 書式

```rep movs```

rep命令は単独で使われることはなく、必ずストリング命令と組み合わせて使用され、ストリング操作を繰り返す  
なお、ストリング命令を使用する際は、ESIとEDIレジスタの値が繰り返しごとにインクリメントされるようにするため、cld命令でDFをクリアする  
DFがセットされていると、ESIとEDIレジスタの値が繰り返しごとにデクリメントされる  
移動するデータのサイズを限定した命令のバリエーションとして、movsb、movsw、movsdがある  
それぞれ、バイト、ワード、ダブルワードのデータを移動

## 交換命令

ソースオペランドとディスティネーションオペランドの内容を交換  
ディスティネーションオペランドとソースオペランドのサイズは統一されている必要あり  
即値使用不可  
双方メモリは不可

### 書式

```xchg ディスティネーションオペランド,ソースオペランド```

### オペランドに指定できる値

|オペランド|指定できる値|
----|----
|ディスティネーションオペランド|レジスタ|
|ソースオペランド|レジスタ、メモリ|

## プッシュとポップ

プログラム実行の際は、メモリ上に「スタック」と呼ばれる特別な構造（LIFO）のデータ保存領域が確保される  
スタック領域はメインメモリに確保され、この領域には、通常、プロシージャ（関数）のパラメータ（引数）やローカル変数が保存される

### スタック上のデータの流れ

|データの操作種別|構造|書式|オペランドに指定できる値|実行時の流れ|
----|----|----
|保存|下から順に積み上げ|```push ソースオペランド```|即値、16OR32ビットの汎用レジスタ、セグメントレジスタ|スタックポインタ（SP又はESP）の値がプッシュした値のサイズだけデクリメント（ソースオペランドは変化なし）|
|取り出し|上から順に取り出し|```pop ソースオペランド```|16OR32ビットの汎用レジスタ、セグメントレジスタ（DS、ES、SS）|スタックポインタ（SP又はESP）の値がプッシュした値のサイズだけインクリメント（ソースオペランドにはポップした値が格納される）|

### 派生命令

|名前|効果|
----|----
|pusha|16ビットのすべてのレジスタを保存|
|popa|16ビットのすべてのレジスタを復帰|
|pushad|32ビットのすべてのレジスタを保存|
|popad|32ビットのすべてのレジスタを復帰|
|pushf|フラグレジスタ全体を保存|
|popf|フラグレジスタ全体を復帰|

<!-- ## ロードとストア -->